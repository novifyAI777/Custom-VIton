# ğŸ“˜ Stage 1 â€” Preprocessing Pipeline

Stage 1 prepares all required inputs for:
- **Stage 2** â†’ VITON-HD Virtual Try-On
- **Stage 3** â†’ PIFuHD 3D Reconstruction

It performs the following steps:

1. **Background Removal** (rembg)
2. **Human Parsing** (SCHP)
3. **Pose Estimation** (YOLOv8-Pose)
4. **Cloth Extraction** (SegFormer Fashion Model)

---

## ğŸ“‚ Directory Structure

```
vton-3d-pipeline/
â”‚
â”œâ”€â”€ stage1_preprocessing/
â”‚   â”œâ”€â”€ image_cleaning/
â”‚   â”‚   â””â”€â”€ rembg_clean.py
â”‚   â”œâ”€â”€ human_parsing/
â”‚   â”‚   â””â”€â”€ infer_parsing.py
â”‚   â”œâ”€â”€ pose_estimation/
â”‚   â”‚   â””â”€â”€ infer_pose.py
â”‚   â”œâ”€â”€ cloth_extraction/
â”‚   â”‚   â””â”€â”€ cloth_seg_infer.py
â”‚   â””â”€â”€ run_stage1.py
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ input/
â”‚   â”‚   â”œâ”€â”€ person.jpg
â”‚   â”‚   â””â”€â”€ dress.jpg
â”‚   â””â”€â”€ stage1_output/
```

---

## ğŸ§¾ Installation

Install required dependencies:

```bash
pip install rembg transformers ultralytics pillow numpy torch
```

If SCHP requires extra dependencies, install them as defined inside the `human_parsing` module.

---

## ğŸ’¾ Input Requirements

Place your input files inside:

```
data/input/person.jpg
data/input/dress.jpg
```

### âœ” person.jpg
- Full-body image of the user
- High resolution recommended
- Clean lighting helps segmentation

### âœ” dress.jpg
- Image of a clothing item
- Must contain one clear garment
- Higher quality â†’ better segmentation

---

## ğŸš€ Running Stage 1

### ğŸ”¹ Run with default inputs:

```bash
python stage1_preprocessing/run_stage1.py
```

### ğŸ”¹ Run with custom inputs:

```bash
python stage1_preprocessing/run_stage1.py path/to/person.jpg path/to/dress.jpg
```

### ğŸ”¹ Run with custom output folder:

```bash
python stage1_preprocessing/run_stage1.py person.jpg dress.jpg output_folder
```

**Example:**

```bash
python stage1_preprocessing/run_stage1.py data/input/person.jpg data/input/dress.jpg data/stage1_output
```

---

## ğŸ“¤ Output Files

After execution, Stage 1 generates:

| File | Description |
|------|-------------|
| `person_clean.png` | Background-removed user image |
| `person_mask.png` | Binary mask generated by rembg |
| `parsing.png` | Full human parsing mask from SCHP |
| `pose_keypoints.json` | Body joint coordinates from YOLOv8-Pose |
| `cloth_clean.png` | Clothing item with transparent background |
| `cloth_mask.png` | Binary segmentation mask of the clothing |

All outputs appear in:

```
data/stage1_output/
```



These outputs feed directly into **Stage 2 (VITON-HD)**.

---

## âš  Troubleshooting

### â— Rembg fails
Try using a higher-resolution, well-lit person image.

### â— SCHP parsing is inaccurate
Body parts must be fully visible.

### â— YOLO Pose misses joints
Ensure entire person is in frame.

### â— Cloth extraction faulty
Use clean images with a single clothing item.

---


## ğŸ“ Notes

- Ensure all input images are in standard formats (JPG, PNG)
- GPU acceleration recommended for faster processing
- Processing time depends on image resolution and hardware

For issues or questions, refer to the main project documentation or open an issue in the repository.
